<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Bart Barnard" /><link rel="canonical" href="https://hanze-hbo-ict.github.io/programming2/week1.4.html" />
      <link rel="shortcut icon" href="img/favicon.ico" />
    <title>Week 1.4: Generators and Map-Reduce - Programming 2</title>
    <link rel="stylesheet" href="css/theme.css" />
    <link rel="stylesheet" href="css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="css/extra.css" rel="stylesheet" />
        <link href="css/ansi-colours.css" rel="stylesheet" />
        <link href="css/jupyter-cells.css" rel="stylesheet" />
        <link href="css/pandas-dataframe.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Week 1.4: Generators and Map-Reduce";
        var mkdocs_page_input_path = "week1.4.md";
        var mkdocs_page_url = "/programming2/week1.4.html";
      </script>
    
    <script src="js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="index.html" class="icon icon-home"> Programming 2
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="index.html">Programming 2</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="week1.1.html">Week 1.1: Static code analysis</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="week1.2.html">Week 1.2: Classes and instances</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="week1.3.html">Week 1.3: Multiple Class Interaction</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="week1.4.html">Week 1.4: Generators and Map-Reduce</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#exercise-1-refactoring-your-own-code">Exercise 1: refactoring your own code.</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#exercise-2-functions-with-data">Exercise 2: functions with data</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#exercise-3-refactoring-other-peoples-code">Exercise 3: refactoring other people's code.</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#step-1-simple-refactor-improvements">Step 1: Simple refactor improvements</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-2-change-the-loop-into-an-iterator">Step 2: Change the loop into an iterator</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-3-make-use-of-a-generator">Step 3: Make use of a generator</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-4-come-up-with-enhancements">Step 4: Come up with enhancements</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="week1.5.html">Week 1.5: Divide and Conquer Algorithms</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Programming 2</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html" class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Week 1.4: Generators and Map-Reduce</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="week-14-generators-and-map-reduce">Week 1.4: Generators and Map-Reduce<a class="headerlink" href="#week-14-generators-and-map-reduce" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>This week, we are going to work with generators and <a href="https://docs.python.org/3/tutorial/datastructures.html#list-comprehensions">list comprehensions</a>. During the theoretical session, we have seen how we can replace the creation of lists in a for-loop with list-comprehensions. That makes our code more readable, more maintainable, and more pythonic. We have also seen how we can make of generators and iterables to hide the exact implementation of our collection while we are iterating over it.</p>
<h2 id="exercise-1-refactoring-your-own-code">Exercise 1: refactoring your own code.<a class="headerlink" href="#exercise-1-refactoring-your-own-code" title="Permanent link">&para;</a></h2>
<p>As a warming up exercise, you are asked to replace the for-loops in your elaboration of <a href="week1.3.html">the exercise of last week</a> with list comprehensions, if you have not already done that. Especially in the consuming classes, it would make sense to use list comprehensions for either the vertical or the horizontal data aggregation. Make sure you know when to use list comprehension and when to use a standard for-loop: both have their place and function in your program, and you should not use comprehensions for the sake of it.</p>
<p>Before doing the refactoring, make sure you have pushed your current code to github. While refactoring, make sure your code keeps on working (make use of <code>assert</code> statements where possible).</p>
<h2 id="exercise-2-functions-with-data">Exercise 2: functions with data<a class="headerlink" href="#exercise-2-functions-with-data" title="Permanent link">&para;</a></h2>
<p>Create a function that has two parameters: one for data (you can assume this to be a list) and one for the function to be applied to that data. Let the function return a list with new values that are created by applying the function to all the values. </p>
<p>For example, when I give a list <code>[1,2,3,4,5]</code> as a first parameter to this function, and a function to multiply all values of a list by two as a second parameter, the return value of this function should be <code>[2,4,6,8,10]</code>. </p>
<p>Now enhance your function so that it can take in an arbitrary number of functions that all need to be applied to the given data. In this second version, the function returns a list of lists: for every application of a given function, there's a list in this return value. So if I were to give two functions to this function, it should return a list of two lists.</p>
<p>Make use of list comprehensions in your elaboration.</p>
<h2 id="exercise-3-refactoring-other-peoples-code">Exercise 3: refactoring other people's code.<a class="headerlink" href="#exercise-3-refactoring-other-peoples-code" title="Permanent link">&para;</a></h2>
<p>Download <a href="files/webcrawler.py">the code for this exercise</a>. This is a script that crawls <a href="https://sport050.nl/sportaanbieders/alle-aanbieders/">a website with sport clubs in the city Groningen</a>. It generates a csv-file with the url, phone-number and email-address of 414 sport clubs. Run the script for a few moments to see what it does (make sure to exit it using <code>CTRL-C</code>, otherwise it will take too long).</p>
<div class="highlight"><pre><span></span><code>baba@host%<span class="w"> </span>python<span class="w"> </span>webcrawler.py<span class="w"> </span>
fetch<span class="w"> </span>urls
getting<span class="w"> </span>sub-urls
extracting<span class="w"> </span>the<span class="w"> </span>data
<span class="m">414</span><span class="w"> </span>sub-urls
https://sport050.nl/sportaanbieders/3x3-unites/<span class="w"> </span><span class="p">;</span><span class="w">  </span><span class="m">06</span>-23929416<span class="w"> </span><span class="p">;</span><span class="w"> </span>a.einolhagh@live.nl
https://sport050.nl/sportaanbieders/40up-fitness/<span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="m">06</span>-81484254<span class="w"> </span><span class="p">;</span><span class="w"> </span>info@40upfitness.nl
https://sport050.nl/sportaanbieders/5ersport/<span class="w"> </span><span class="p">;</span><span class="w">  </span><span class="p">;</span><span class="w"> </span>5ersporten@gmail.com?subject<span class="o">=</span>Bericht%20via%20Sport050.nl%20
https://sport050.nl/sportaanbieders/s-exstudiantes/<span class="w"> </span><span class="p">;</span><span class="w">  </span><span class="p">;</span><span class="w"> </span>
https://sport050.nl/sportaanbieders/agsr-gyas/<span class="w"> </span><span class="p">;</span><span class="w">  </span>+<span class="w"> </span><span class="m">050</span><span class="w"> </span><span class="m">526</span><span class="w"> </span><span class="m">7445</span><span class="w"> </span><span class="p">;</span>
</code></pre></div>
<h3 id="step-1-simple-refactor-improvements">Step 1: Simple refactor improvements<a class="headerlink" href="#step-1-simple-refactor-improvements" title="Permanent link">&para;</a></h3>
<p>At the moment, all of the code is working within the global namespace. This is bad for maintainability and re-useability. Create a class <code>Crawler</code> in which you copy the code as it now is. Make a method <code>crawl_site()</code> within this class in which you put the main loop (the one that starts at line 102). Remember to add <code>self</code> as a first parameter to most method of this new class (at least one of the methods can be changed into a <code>@staticmethod</code>...).</p>
<p>Now create a second file <code>main.py</code> in which you import the <code>Crawler</code>-class. Make a new instance of this class and call the main loop method (<code>crawl_site</code>) that you have created. If all goes well, the result should be the same as before. Again, make sure to exit the program with <code>CTRL-C</code> after a few runs.</p>
<p>At four places at the code, there are lambda expressions; there are even lambda expressions <em>within</em> list comprehension. Remove all of these, so that we only have list comprehensions in the end. Do <em>not</em> replace the main loop with a list comprehension, as we will be changing this method later on.</p>
<h3 id="step-2-change-the-loop-into-an-iterator">Step 2: Change the loop into an iterator<a class="headerlink" href="#step-2-change-the-loop-into-an-iterator" title="Permanent link">&para;</a></h3>
<p>Until now, we had to stop the execution of the code by hand (by hitting <code>CTRL-C</code>). This is because the main loop (in <code>crawl_site</code>) runs for all the sub-sites it has found on the site itself. This is, of course, fine if you don't want to do anything else as long as this loop runs, but in order to have more control over the flow of the crawler, it would be better if we were to control the number of sites it needs to parse.</p>
<p>Change the method <code>crawl_site()</code> so that it makes use of an internal pointer of the instance (which you need to initialize when you create an instance of the <code>Crawler</code> class). Have a look at the <code>iterator.py</code>-example that <a href="files/iterator.py">you can find via this link</a> to get an idea of how this needs to be done. Note: you need to refactor the loop in <code>crawl_site()</code> in order to make this work.</p>
<p>If your implementation is correct, you should be able to run the test-code below without errors:</p>
<div class="highlight"><pre><span></span><code>    <span class="n">crawler</span> <span class="o">=</span> <span class="n">Crawler</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="nb">print</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">crawler</span><span class="p">)))</span>
    <span class="c1">#Result: five lines of data</span>
</code></pre></div>
<p>When you have completed this refactoring, commit your code to git.</p>
<h3 id="step-3-make-use-of-a-generator">Step 3: Make use of a generator<a class="headerlink" href="#step-3-make-use-of-a-generator" title="Permanent link">&para;</a></h3>
<p>During the theoretical session, we have talked about the use of <code>__iter__()</code> and <code>__next__()</code> methods. Alas, you cannot use <code>yield</code> in a <code>__next__()</code>-method (read <a href="https://stackoverflow.com/a/49862949/10974490">this answer of SO</a> to get a good idea of the difference between iterators and generators). However, we <em>can</em> organize our classes in such a way that we don't need the internal pointer to do the bookkeeping. Have a look at the demo-file <code>generator.py</code>, that you can find <a href="files/generator.py">using this link</a>.</p>
<p>Refactor the code of <code>Crawler</code> in such a way that it makes use of a generator to keep track of the current site that needs to be crawled. If you have done this correctly, you should be able to run the same test-code as in step 2 without much difference in the output.</p>
<h3 id="step-4-come-up-with-enhancements">Step 4: Come up with enhancements<a class="headerlink" href="#step-4-come-up-with-enhancements" title="Permanent link">&para;</a></h3>
<p>If you look at the code and you think back about the SOLID principles we discussed during our first session, what other refactoring candidates can you spot in this code? Add a small piece of text to your repo in which you analyse this code.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="week1.3.html" class="btn btn-neutral float-left" title="Week 1.3: Multiple Class Interaction"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="week1.5.html" class="btn btn-neutral float-right" title="Week 1.5: Divide and Conquer Algorithms">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>Bart Barnard</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="week1.3.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="week1.5.html" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '.';</script>
    <script src="js/theme_extra.js" defer></script>
    <script src="js/theme.js" defer></script>
      <script src="js/imgs.js" defer></script>
      <script src="js/matjax.js" defer></script>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6" defer></script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" defer></script>
      <script src="search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
