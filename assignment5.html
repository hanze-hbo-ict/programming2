<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Bart Barnard" /><link rel="canonical" href="https://bioinf.nl/~bbarnard/programming4/assignment5.html" />
      <link rel="shortcut icon" href="img/favicon.ico" />
    <title>5. Final assignment - Programming 4</title>
    <link rel="stylesheet" href="css/theme.css" />
    <link rel="stylesheet" href="css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="css/extra.css" rel="stylesheet" />
        <link href="css/ansi-colours.css" rel="stylesheet" />
        <link href="css/jupyter-cells.css" rel="stylesheet" />
        <link href="css/pandas-dataframe.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "5. Final assignment";
        var mkdocs_page_input_path = "assignment5.md";
        var mkdocs_page_url = "/~bbarnard/programming4/assignment5.html";
      </script>
    
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="index.html" class="icon icon-home"> Programming 4
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="index.html">Introduction</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="assignment1.html">1. Static code analysis</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="assignment2.html">2. Multiple Class Interaction</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="assignment3.html">3. List comprehensions and generators</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="assignment4.html">4. Parallellisation</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">5. Final assignment</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#step-1-getting-and-transforming-the-data">Step 1: getting and transforming the data</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#step-2-create-the-model-and-the-drawer">Step 2: create the model and the drawer</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#step-4-listening-for-new-data">Step 4: listening for new data</a>
    </li>
    </ul>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Programming 4</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">5. Final assignment</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="assignment-5-a-complete-project">Assignment 5: A complete project<a class="headerlink" href="#assignment-5-a-complete-project" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>In this last assignment, you are asked to work on a relative big application which you need to divide in several classes. You are going to develop a small pipeline with several interacting components that work independent of each other. During the development, you need to take into account all the things we talked about in this module.</p>
<p>The application you are going to make, makes use of a <em>trained</em> machine learning model, so this assignment is kind of an integration of DS3 with Programming 2. Have a look at the general machine learning development cycle below. Though we will go through all the steps, the focus will be on steps 3, 4, 5 and 6.</p>
<p><img alt="The general development cycle of a ML project" src="imgs/development-cycle.png" /></p>
<h2 id="step-1-getting-and-transforming-the-data">Step 1: getting and transforming the data<a class="headerlink" href="#step-1-getting-and-transforming-the-data" title="Permanent link">&para;</a></h2>
<p>For this exercise, we are elaborating on the anomaly detection study case that <a href="https://github.com/fenna/BFVM23DATASCNC5/blob/main/Study_Cases/Study_Case_Anomaly_Detection.ipynb">is part of the unsupervised part of DS3</a>. Head over to that notebook, study its contents and download the accompanying dataset. You can also find the dataset at Kaggle: <a href="https://www.kaggle.com/datasets/nphantawee/pump-sensor-data">https://www.kaggle.com/datasets/nphantawee/pump-sensor-data</a></p>
<div class="admonition info">
<p class="admonition-title">Use your own dataset</p>
<p>You can also use your own dataset, but only if it fulfills the following requirements:</p>
<ul>
<li>There is a <em>logical (ontological, domain-specific) reason</em> why this dataset grows over time, e.g. when more images become available every month, or new prices of something are published every day, or new network connections are delivered every week;</li>
<li>The data you already have is <em>large enough</em> (contains enough instances) to be split along the lines described above, i.e. you must be able to <em>train</em> a model on roughly three-fifth of the dataset and test the complete pipeline at least twice on the remaining splits;</li>
<li>In order for the model to work correctly, the data needs some kind of <em>non trivial transformation</em>, like removing outliers, or merging, dropping or calculating columns;</li>
<li>Every run of the model on new data should result in an interesting plot of the data.</li>
</ul>
<p>Please check this with the teacher.</p>
</div>
<p>The dataset contains sensor data from 1 April to 31 August 2018. We're going to train the model on the months April, May, and June and then use the trained model to predict the anomalies of the months July and August. Split the original dataset among these lines, so that eventually you have three files. We use the first of these to actually train the model, and then feed the second and third files to this persisted model sequentially.</p>
<h2 id="step-2-create-the-model-and-the-drawer">Step 2: create the model and the drawer<a class="headerlink" href="#step-2-create-the-model-and-the-drawer" title="Permanent link">&para;</a></h2>
<p>Using the first of the three splits described above, train one of the models from the notebook, or use your own realisation. Note that in order to do this training, some data-transformations are necessary. Isolate these relevant transformations, so that they can be performed later on the two remaining sets. Train the model on the transformed dataset. Use one of the techniques <a href="https://scikit-learn.org/stable/model_persistence.html">described on scikit-learn.org</a> to persist the model on your local file system. </p>
<div class="admonition warning">
<p class="admonition-title">Transform only the training-data</p>
<p>For this exercise, it is <em>imparitive</em> that you perform the data-transformations <em>after</em> you split the original data and <em>only</em> on the training-data. In this way, we can correctly simulate the entering of future data in our pipeline.</p>
</div>
<p>Study the method <code>plot_sensor_anomolies(sensor, name)</code> that you can find <a href="https://github.com/fenna/BFVM23DATASCNC5/blob/main/Study_Cases/Study_Case_Anomaly_Detection.ipynb">in the notebook</a>. In the current setup, this method can only work if the dataframe <code>df</code> is defined within the scope of the complete notebook (so only if <code>df</code> is a <em>global variable</em>). Refactor this method so that is <em>independent</em> of any global variables (global variables are bad news in general). Also, change its functionality so that it <em>returns</em> the plot instead of displaying it.</p>
<h2 id="step-4-listening-for-new-data">Step 4: listening for new data<a class="headerlink" href="#step-4-listening-for-new-data" title="Permanent link">&para;</a></h2>
<p>Now that we have trained and saved our model, it is time to put it into production. For this to work, we are going to make another class that looks at a specific directory. When a new data file is uploaded to this directory, this class will load the data in that file, apply the necessary changes and use our model to predict new new values. It then saves the transformed data with the predictions in another directory and removes the original data file. </p>
<p>Apart from saving the transformed and enriched data, it will also create images of certain sensors and save those in the <code>img</code> directory – their filename displaying both the sensor and the timestamp. Have a look at the sequence diagram below to get an idea of what is happening.</p>
<p><img alt="The sequence diagram of the end product" src="imgs/sequence-diagram.png" /></p>
<p>The whole process need to be logged in a log-file. A typical run will produce the following lines in this log-file:</p>
<div class="highlight"><pre><span></span><code><span class="m">2024</span>-06-11<span class="w"> </span><span class="m">10</span>:09:32<span class="w">  </span>Found<span class="w"> </span>new<span class="w"> </span>data<span class="w"> </span>file
<span class="m">2024</span>-06-11<span class="w"> </span><span class="m">10</span>:09:32<span class="w">  </span>Loaded<span class="w"> </span>the<span class="w"> </span>file<span class="w"> </span>
<span class="m">2024</span>-06-11<span class="w"> </span><span class="m">10</span>:09:34<span class="w">  </span>Received<span class="w"> </span>transformed<span class="w"> </span>data
<span class="m">2024</span>-06-11<span class="w"> </span><span class="m">10</span>:09:38<span class="w">  </span>Received<span class="w"> </span>predicions
<span class="m">2024</span>-06-11<span class="w"> </span><span class="m">10</span>:09:38<span class="w">  </span>Saving<span class="w"> </span>predictions
<span class="m">2024</span>-06-11<span class="w"> </span><span class="m">10</span>:09:40<span class="w">  </span>Saving<span class="w"> </span>image2<span class="w"> </span><span class="m">2018</span>-07-sensor04.png
<span class="m">2024</span>-06-11<span class="w"> </span><span class="m">10</span>:09:40<span class="w">  </span>Saving<span class="w"> </span>image2<span class="w"> </span><span class="m">2018</span>-07-sensor51.png
<span class="m">2024</span>-06-11<span class="w"> </span><span class="m">10</span>:09:40<span class="w">  </span>Resuming<span class="w"> </span>listening
</code></pre></div>
<p>If the new file in the <code>input</code>-directory does not contain data that is eligable for the system, an error needs to be logged to the log-file. This should, however, not break the running of the application.</p>
<p>Test your realisation with the two separate data files you have created – the ones containing the data for July and for August: when you put one of them in the <code>input</code>-directory, the whole cycle should start and create a new data file in the <code>output</code>-directory and a new image in the <code>img</code>-directory.</p>
<div class="admonition warning">
<p class="admonition-title">Technical requirements</p>
<ul>
<li>all files and classes should be <em>independent</em> of each other: they should adhere to the SOLID-principles.</li>
<li>
<p>the application should make use of a file <code>application.json</code> in which the following settings are present:</p>
<ul>
<li>the location of the <code>input</code>-directory</li>
<li>the location of the <code>output</code>-directory</li>
<li>the location of the <code>img</code>-directory</li>
<li>the names of the sensors that needs to be drawn</li>
<li>the interval (in seconds) with which the <code>input</code>-directory is checked for new files </li>
</ul>
</li>
</ul>
</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="assignment4.html" class="btn btn-neutral float-left" title="4. Parallellisation"><span class="icon icon-circle-arrow-left"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>Bart Barnard</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="assignment4.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
  </span>
</div>
    <script src="js/jquery-3.6.0.min.js"></script>
    <script>var base_url = ".";</script>
    <script src="js/theme_extra.js"></script>
    <script src="js/theme.js"></script>
      <script src="js/imgs.js"></script>
      <script src="js/matjax.js"></script>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
