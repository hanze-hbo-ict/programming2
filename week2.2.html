<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Bart Barnard" /><link rel="canonical" href="https://hanze-hbo-ict.github.io/programming2/week2.2.html" />
      <link rel="shortcut icon" href="img/favicon.ico" />
    <title>Week 2.2: Parallellisation - Programming 2</title>
    <link rel="stylesheet" href="css/theme.css" />
    <link rel="stylesheet" href="css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="css/extra.css" rel="stylesheet" />
        <link href="css/ansi-colours.css" rel="stylesheet" />
        <link href="css/jupyter-cells.css" rel="stylesheet" />
        <link href="css/pandas-dataframe.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Week 2.2: Parallellisation";
        var mkdocs_page_input_path = "week2.2.md";
        var mkdocs_page_url = "/programming2/week2.2.html";
      </script>
    
    <script src="js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="index.html" class="icon icon-home"> Programming 2
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="index.html">Programming 2</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="week1.1.html">Week 1.1: Static code analysis</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="week1.2.html">Week 1.2: Classes and instances</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="week1.3.html">Week 1.3: Multiple Class Interaction</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="week1.4.html">Week 1.4: Generators and Map-Reduce</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="week1.5.html">Week 1.5: Divide and Conquer Algorithms</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="week2.1.html">Week 2.1: Network operations</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="week2.2.html">Week 2.2: Parallellisation</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#step-0-obtaining-an-api-key">step 0: obtaining an API key</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#step-1-install-and-use-the-biopython-package">step 1: install and use the biopython package</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#step-2-download-the-referenced-articles">step 2: download the referenced articles</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#extra-challenge">extra challenge</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="week2.3.html">Week 2.3: Dask</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="week2.4.html">Week 2.4: More on Dask</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="week2.5.html">Week 2.5: MLOps</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="week2.6.html">Week 2.6: SE4ML</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Programming 2</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html" class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li>Week 2.2: Parallellisation</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="week-22-parallellisation">Week 2.2: Parallellisation<a class="headerlink" href="#week-22-parallellisation" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>In the plenairy part we have discussed how you can make use of Python's <a href="https://docs.python.org/3/library/multiprocessing.html"><code>multiprocessor</code> module</a> to distribute the computation of your problem over multiple cores on your CPU. We have seen how this increased performances when you are working with a lot of data, or when you need to do complex calculations.</p>
<p><img alt="The comparison of calculations in serial and multiprocessor mode" src="imgs/comparison-serial-mp.png" /></p>
<p>Even though the <code>multiprocessor</code> module is quite complex, the basic workings of it is quite simple. You provide your code with the number of cores you wish to use, some data you want to work with and a function that needs to be called for all the elements of your data. You use <a href="https://docs.python.org/3/library/functions.html#map">the function <code>map</code></a> for this minimal working example. For easy reference, the relevant portion of the code of the plenairy part is repeated below:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">multiprocessor</span> <span class="k">as</span> <span class="nn">mp</span>
<span class="k">with</span> <span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">()</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">sum_squared</span><span class="p">,</span> <span class="n">numbers</span><span class="p">)</span>
</code></pre></div>
<p>In this exercise we are going to make use of <a href="https://biopython.org/">the biopython package</a> to harvest the first ten references quoted by a random article <a href="https://www.ncbi.nlm.nih.gov/">on the National Center for Biotechnology Information</a>. Because harvesting and saving files can be a time consuming process, it makes sense use multiple cores for this task.</p>
<h2 id="step-0-obtaining-an-api-key">step 0: obtaining an API key<a class="headerlink" href="#step-0-obtaining-an-api-key" title="Permanent link">&para;</a></h2>
<p>Alas, since a few years having an API key is required to automatically download articles from the NCBI; such a key enables a data-provider to monitor who is using what data. However, it is good to practice this procedure, since you will no doubt come across this at other times in your career. You don't need to program anything for this step: we will just guide you throught it.</p>
<p>Go to <a href="https://www.ncbi.nlm.nih.gov/myncbi/">the signin-page of the NBCI</a>, scroll down a little bit until you see the button <code>more login options</code>. Click on that button and on the next page search for 'Hanze'; you will see an option to log in with your Hanze account (which is basically a Microsoft account). Log in with your Hanze credentials:</p>
<p><img alt="Click on the 'more login options' button below" src="imgs/onboarding1.png" /></p>
<p><img alt="Search for 'Hanze' in order to get a link to login with your Hanze account" src="imgs/onboarding2.png" /></p>
<p>Once you are logged in, click on your profile image in the top right corner and in the drop-down that appears select <code>Account settings</code>. Scroll down a little bit until you see a button <code>Create an API Key</code>.</p>
<p><img alt="Select the 'Account Settings' in the drop down" src="imgs/onboarding3.png" /></p>
<p><img alt="Click on the 'Create an API Key' button below" src="imgs/onboarding4.png" /></p>
<p>When you click this button, your API key is generated and displayed. Copy this string and save it on a convenient place: you will need to provide this key for every request to the NCBI.</p>
<p><img alt="Finally, the API Key is generated" src="imgs/onboarding5.png" /></p>
<h2 id="step-1-install-and-use-the-biopython-package">step 1: install and use the biopython package<a class="headerlink" href="#step-1-install-and-use-the-biopython-package" title="Permanent link">&para;</a></h2>
<p>As said, in this exercise we are going to use the <a href="https://biopython.org/">biopython package</a>. You can just <code>pip install</code> this package and start working with it. Biopython is a very useful, but very HUGE library on dealing with biomedical data. Because this assignment really is meant to get you to use the multiprocessing facilities, rather than trying to teach you to use Biopython itself, we will provide you with the necessary code that you can tinker to fullfill the assignment. However, we urge you to study the package in its totality, as it will surely come in handy at times.</p>
<p>Specifically, we will be using <a href="http://biopython.org/DIST/docs/tutorial/Tutorial.html#sec144">the <code>Entrez</code> class</a> of the library. This class is an API to <a href="https://www.ncbi.nlm.nih.gov/books/NBK25497/">the query and database system of the NBCI</a>. It can be used to query all kinds of databases and systems. Have a look at the code below to see how we can query the pubmed database for a specific article (one with an id of <code>'30049270"'</code> (note: the id's are strings)):</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">Bio</span> <span class="kn">import</span> <span class="n">Entrez</span>

<span class="c1"># the next two lines are needed to create an environment in which the </span>
<span class="c1"># ssl doesn&#39;t complain about non-existing public keys...</span>
<span class="kn">import</span> <span class="nn">ssl</span>
<span class="n">ssl</span><span class="o">.</span><span class="n">_create_default_https_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span>

<span class="c1">#enter your email here; the one you used to create an api key in step 0</span>
<span class="n">Entrez</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> 

<span class="n">file</span> <span class="o">=</span> <span class="n">Entrez</span><span class="o">.</span><span class="n">elink</span><span class="p">(</span><span class="n">dbfrom</span><span class="o">=</span><span class="s2">&quot;pubmed&quot;</span><span class="p">,</span>
                   <span class="n">db</span><span class="o">=</span><span class="s2">&quot;pmc&quot;</span><span class="p">,</span>
                   <span class="n">LinkName</span><span class="o">=</span><span class="s2">&quot;pubmed_pmc_refs&quot;</span><span class="p">,</span>
                   <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;30049270&quot;</span><span class="p">,</span>
                   <span class="n">api_key</span><span class="o">=</span><span class="s1">&#39;&lt;YOUR API KEY HERE&gt;&#39;</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">Entrez</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">results</span><span class="p">)</span>
</code></pre></div>
<p>In this case, we use <a href="http://biopython.org/DIST/docs/tutorial/Tutorial.html#sec150"><code>elink</code></a>; this doesn't give us the whole article, but only information that is <em>related</em> to the article. We can, for example, use this to get all the <code>ID</code>s of all the articles that are referenced in this one:</p>
<div class="highlight"><pre><span></span><code><span class="n">references</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">link</span><span class="p">[</span><span class="s2">&quot;Id&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;LinkSetDb&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;Link&quot;</span><span class="p">]]</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">references</span><span class="p">)</span>
</code></pre></div>
<p>If we wanted to obtain the article with authors and abstract, we should have used <a href="http://biopython.org/DIST/docs/tutorial/Tutorial.html#sec149"><code>efetch</code></a>. In the code below, we receive all the information of the article in question in xml-format:</p>
<div class="highlight"><pre><span></span><code><span class="n">handle</span> <span class="o">=</span> <span class="n">Entrez</span><span class="o">.</span><span class="n">efetch</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="s2">&quot;pubmed&quot;</span><span class="p">,</span>
                <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;30049270&#39;</span><span class="p">,</span>
                <span class="n">retmode</span><span class="o">=</span><span class="s2">&quot;xml&quot;</span><span class="p">,</span>
                <span class="n">api_key</span><span class="o">=</span><span class="s1">&#39;&lt;YOUR API KEY HERE&gt;&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">handle</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</code></pre></div>
<h2 id="step-2-download-the-referenced-articles">step 2: download the referenced articles<a class="headerlink" href="#step-2-download-the-referenced-articles" title="Permanent link">&para;</a></h2>
<p>With the examples above, you should be able to perform the exercise itself. Make use of the <code>Entrez</code> class to obtain the ten first references of an article. You need to be able to provide your script with pubmed id. Your script will look up the references of that article and download the full record of the first ten of these (in xml format). It needs to save these ten full records on your file system, with the id of the reference as its filename (and <code>xml</code> as its extension). So if I were to run your script with pumed-id <code>'30049270'</code>, the listing of the directory would look somewhat like the following (of course, your hostname, username and path will differ from ours):</p>
<div class="highlight"><pre><span></span><code><span class="o">(</span>masterdt<span class="o">)</span><span class="w"> </span>baba@grisea<span class="w"> </span>Exercise<span class="w"> </span>%<span class="w"> </span>ls<span class="w"> </span>-l
total<span class="w"> </span><span class="m">136</span>
<span class="m">10013231</span>.xml
<span class="m">10023427</span>.xml
<span class="m">10029973</span>.xml
<span class="m">9788541</span>.xml
<span class="m">9821373</span>.xml
<span class="m">9843110</span>.xml
<span class="m">9884887</span>.xml
<span class="m">9892353</span>.xml
<span class="m">9970664</span>.xml
<span class="m">9983048</span>.xml
<span class="o">(</span>masterdt<span class="o">)</span><span class="w"> </span>baba@grisea<span class="w"> </span>Exercise<span class="w"> </span>%<span class="w"> </span>
</code></pre></div>
<p>You must use the <code>multiprocessor</code> package for the download of these articles. </p>
<h2 id="extra-challenge">extra challenge<a class="headerlink" href="#extra-challenge" title="Permanent link">&para;</a></h2>
<p>If you want and have some time to spare, try to do the same exercise without the <code>multiprocessor</code> package. use <code>time</code> to measure the time it took to execute both versions; do you see a difference?</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="week2.1.html" class="btn btn-neutral float-left" title="Week 2.1: Network operations"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="week2.3.html" class="btn btn-neutral float-right" title="Week 2.3: Dask">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>Bart Barnard</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="week2.1.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="week2.3.html" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '.';</script>
    <script src="js/theme_extra.js" defer></script>
    <script src="js/theme.js" defer></script>
      <script src="js/imgs.js" defer></script>
      <script src="js/matjax.js" defer></script>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6" defer></script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" defer></script>
      <script src="search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
